/*! jQuery.pjaxR v1.0.0 | Copyright (c) 2013 Stephan Gross | MIT License | minddust.com */
(function(a){function c(b,r){return this.on("click.pjaxr",b,function(b){var d=b.currentTarget;if("A"!==d.tagName.toUpperCase())throw"$.fn.pjaxXR requires an anchor element";if(!(1<b.which||b.metaKey||b.ctrlKey||b.shiftKey||b.altKey||b.isDefaultPrevented()||location.protocol!==d.protocol||location.hostname!==d.hostname||d.hash&&d.href.replace(d.hash,"")===location.href.replace(location.hash,"")||d.href===location.href+"#")){var d={url:a.isFunction(d.href)?d.href():d.href,type:"GET",dataType:"html",target:d},f=c.options=a.extend(!0,{},a.ajaxSettings,d,a.fn.pjaxr.defaults,r);if(g("pjaxr:click",[f])){var e;f.beforeSend=function(a,b){if(!g("pjaxr:beforeSend",[a,b]))return!1;a.setRequestHeader("X-PJAX","true");0<b.timeout&&(e=setTimeout(function(){g("pjaxr:timeout",[a,f])&&a.abort("timeout")},b.timeout),b.timeout=0);return!0};c.state||(c.state={id:(new Date).getTime(),url:window.location.href,title:document.title},window.history.replaceState(c.state,c.state.title,c.state.url));(d=c.xhr)&&4>d.readyState&&(d.onreadystatechange=a.noop,d.abort());d=c.xhr=a.ajax(f);0<d.readyState&&g("pjaxr:start",[f]);d.done(function(b,d,r){var e="function"===typeof f.version?f.version():f.version,k=r.getResponseHeader("X-PJAX-Version");if(e&&k&&e!==k)t(f.url);else if(e=b.match(/<pjaxr-head>([\s\S.]*)<\/pjaxr-head>/i),k=b.match(/<pjaxr-body>([\s\S.]*)<\/pjaxr-body>/i),e||k){document.activeElement.blur();var B=(new Date).getTime();if(e)var n=a(a.parseHTML(e[0],document,!0)),p=v("forward",n.children(),null,null),n=p[0],q=p[1],p=p[2];if(k)var u=a(a.parseHTML(k[0],document,!0)),s=w(u.children()),u=s[0],s=s[1];a(document).find("input[autofocus], textarea[autofocus]").last().focus();"number"===typeof f.scrollTo&&a(window).scrollTop(f.scrollTo);a.extend(c.state,{head_revert:e?q:null,head_remove:e?p:null,body_revert:k?s:null});(f.push||f.replace)&&window.history.replaceState(c.state,c.state.title,c.state.url);c.state={id:B,url:f.url,title:document.title,head_apply:e?n:null,body_apply:k?u:null};f.push?window.history.pushState(c.state,c.state.title,c.state.url):f.replace&&window.history.replaceState(c.state,c.state.title,c.state.url);g("pjaxr:done",[b,d,r,f])}else t(f.url)});d.fail(function(a,b,d){"abort"!==b&&g("pjaxr:fail",[a,b,d,f])&&t(f.url)});d.always(function(){e&&clearTimeout(e);g("pjaxr:always",[f]);g("pjaxr:end",[f])})}b.preventDefault()}})}function n(b,c){var k=[],d=[],f=[];b&&0<b.length&&a.each(b,function(b,l){var h=a(l);if(h.is("title"))document.title=h.text();else if(h.is("meta")){var m,g=h.attr("name"),n=h.attr("property");g?m=a("head > meta[name="+g+"]"):n&&(m=a("head > meta[property="+n+"]"));0<m.length?(f.push(e(m)),m.remove()):d.push(e(h));!0===c&&(a("head").append(h),k.push(e(h)))}else if(h.is("link")){if(m=h.attr("href"))g=a("head > link[href="+m+"]"),0<g.length?(f.push(e(g)),g.remove()):d.push(e(h)),!0===c&&(a("head").append(h),k.push(e(h)))}else if(h.is("script")){if(m=h.attr("href"))m=a("head > script[href="+m+"]"),0<m.length?(f.push(e(g)),m.remove()):d.push(e(m)),!0===c&&(a("head").append(h),k.push(e(h)))}else h.is("style")&&!0===c&&(a("head").append(h),k.push(e(h)),d.push(e(h)))});return[k,d,f]}function v(b,c,k,d){var f=[],g=[],l=[];"forward"===b?a("head > [data-remove-on-pjaxr]").each(function(){var b=a(this);l.push(e(b));b.remove()}):"back"===b&&(b=n(k,!1),d=n(d,!0),a.extend(g,b[1]),a.extend(l,d[2]));c=n(c,!0);a.extend(f,c[0]);a.extend(g,c[1]);a.extend(l,c[2]);return[f,g,l]}function w(b){var c=[],g=[];b&&0<b.length&&a.each(b,function(b,f){var n=a(f),l=n.attr("id");l&&(l=a("#"+l),0<l.length&&(g.push(e(l)),l.html(n.html()),c.push(e(l))))});return[c,g]}function g(b,e){var g=a.Event(b,{relatedTarget:c.options.target});a(document).trigger(g,e);return!g.isDefaultPrevented()}function e(a){return a.clone().wrap("<p>").parent().html()}function t(a){window.history.replaceState(null,"","#");window.location.replace(a)}function x(a){if(a=a.state){if(q&&C==a.url)return;g("pjaxr:start",[c.options]);document.title=a.title;var e=c.state.id<a.id?"forward":"back";v(e,a.head_apply,a.head_revert,a.head_remove);(e="forward"===e?a.body_apply:a.body_revert)&&0<e.length&&w(e);c.state=a;document.body.offsetHeight;g("pjaxr:end",[c.options])}q=!1}function D(){return a("meta").filter(function(){return"X-PJAX-VERSION"===String(a(this).attr("http-equiv")).toUpperCase()}).attr("content")}function y(){a.fn.pjaxr=c;a.fn.pjaxr.enable=a.noop;a.fn.pjaxr.disable=z;a.fn.pjaxr.defaults={timeout:650,push:!0,replace:!1,scrollTo:0,version:D};a(window).on("popstate.pjaxr",x)}function z(){a.fn.pjaxr=function(){return this};a.fn.pjaxr.enable=y;a.fn.pjaxr.disable=a.noop;a(window).off("popstate.pjaxr",x)}var q=!0,C=window.location.href,A=window.history.state;A&&(c.state=A);"state"in window.history&&(q=!1);0>a.inArray("state",a.event.props)&&a.event.props.push("state");a.support.pjaxr=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);a.support.pjaxr?y():z()})(jQuery);